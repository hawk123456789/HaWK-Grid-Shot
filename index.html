<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div
        style="display: flex; justify-content: center; gap: 40px; margin-bottom: 20px; font-family: 'Arial', sans-serif;">
        <div style="text-align: center;">
            <p style="margin: 0; color: #7f8c8d;">SCORE</p>
            <h2 id="score" style="margin: 0; color: #2c3e50;">0</h2>
        </div>
        <div style="text-align: center;">
            <p style="margin: 0; color: #7f8c8d;">ACCURACY</p>
            <h2 id="accuracy" style="margin: 0; color: #2c3e50;">100%</h2>
        </div>
        <div style="text-align: center;">
            <p style="margin: 0; color: #7f8c8d;">TIME</p>
            <h2 id="timer" style="margin: 0; color: #e74c3c;">30s</h2>
        </div>
    </div>

    <div id="play-area" onclick="missClick()"
        style="position: relative; width: 100%; max-width: 900px; height: 500px; background: #2c3e50; border-radius: 20px; margin: 0 auto; overflow: hidden; cursor: crosshair; border: 4px solid #34495e;">
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button onclick="startGame()" id="start-btn"
            style="padding: 15px 40px; background: #2ecc71; color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 18px;">START
            TRAINING</button>
    </div>

    <style>
        /* สไตล์ของเป้ายิง */
        .target {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #ff7675, #d63031);
            border: 4px solid white;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 0 15px rgba(214, 48, 49, 0.5);
        }

        .target:active {
            transform: scale(0.8);
        }
    </style>
</body>
<script>
    // 1. ตั้งค่าตัวแปร (Variables)
    let score = 0;
    let totalClicks = 0;
    let hits = 0;
    let timeLeft = 30;
    let gameActive = false;
    let timerInterval;
    let lastPositions = []; // สำหรับเช็คจุดเกิดซ้ำ

    // 2. ตั้งค่าเสียง (Audio) - พี่สามารถเปลี่ยน URL เป็นไฟล์ในเครื่องได้
    const hitSound = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
    const missSound = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3');

    const playArea = document.getElementById('play-area');
    const scoreEl = document.getElementById('score');
    const accuracyEl = document.getElementById('accuracy');
    const timerEl = document.getElementById('timer');

    // 3. ฟังก์ชันเริ่มเกม
    function startGame() {
        score = 0;
        totalClicks = 0;
        hits = 0;
        timeLeft = 30;
        gameActive = true;
        lastPositions = []; // ล้างค่าตำแหน่งเก่า
        playArea.innerHTML = '';
        document.getElementById('start-btn').style.display = 'none';

        updateStats();
        for (let i = 0; i < 3; i++) { createTarget(); }

        timerInterval = setInterval(() => {
            timeLeft--;
            timerEl.innerText = timeLeft + 's';
            if (timeLeft <= 0) endGame();
        }, 1000);
    }

    // 4. ฟังก์ชันสร้างเป้า (แบบไม่ซ้ำจุดเดิม)
    function createTarget() {
        if (!gameActive) return;

        const target = document.createElement('div');
        target.className = 'target';

        let x, y, isTooClose;
        let attempts = 0; // กัน Bug กรณีหาที่ว่างไม่ได้

        do {
            isTooClose = false;
            x = Math.random() * (playArea.clientWidth - 60);
            y = Math.random() * (playArea.clientHeight - 60);

            // เช็คระยะห่างจากเป้าอื่นๆ บนจอ
            lastPositions.forEach(pos => {
                const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                if (distance < 100) isTooClose = true;
            });
            attempts++;
        } while (isTooClose && attempts < 20); // สุ่มใหม่ถ้าใกล้เกินไป แต่ไม่เกิน 20 ครั้ง

        const posObj = { x, y, id: Date.now() + Math.random() };
        lastPositions.push(posObj);

        target.style.left = x + 'px';
        target.style.top = y + 'px';

        target.onclick = (e) => {
            e.stopPropagation();
            hitSound.currentTime = 0; // ให้เสียงเริ่มใหม่ทันที
            hitSound.play();

            hits++;
            totalClicks++;
            score += 100;

            lastPositions = lastPositions.filter(p => p.id !== posObj.id);
            target.remove();
            createTarget();
            updateStats();
        };

        playArea.appendChild(target);
    }

    // 5. ฟังก์ชันคลิกพลาด
    function missClick() {
        if (!gameActive) return;
        missSound.currentTime = 0;
        missSound.play();
        totalClicks++;
        score = Math.max(0, score - 50);
        updateStats();
    }

    function updateStats() {
        scoreEl.innerText = score;
        const acc = totalClicks === 0 ? 100 : Math.round((hits / totalClicks) * 100);
        accuracyEl.innerText = acc + '%';
    }

    function endGame() {
        gameActive = false;
        clearInterval(timerInterval);
        alert(`Time's up! Score: ${score} | Acc: ${accuracyEl.innerText}`);
        document.getElementById('start-btn').style.display = 'inline-block';
    }
</script>


</html>